= Dossier d'Architecture Technique

== ARCHITECTURE LOGIQUE

image::assets/ArchitectureLogique.png[]

.Composants
|===
|Composant | Fonction

|Keycloak
|Serveur d'Authentication

|Kafka
|Bus de messages

|Blob Management
|Gestion du stockage de Fichiers

|User Management
|Gestion des données Utilisateur

|Mission Management
|Gestion des données Mission

|Team Management
|Gestion des données Equipe

|User Skill Management
|Gestion des compétences des Utilisateurs

|Team Skill Management
|Gestion des compétences des Equipes

|Plan de charge
|Plan de charge

|Carnet de commandes
|Carnet de commandes

|Calendrier
|Calendrier des Utilisateus et Alerting

|Tableau des effectifs
|Gestion des effectifs

|===


=== Authentification

=== Evenements


== ARCHITECTURE PHYSIQUE

=== Cluster Kubernetes

=== Partitions NFS

=== Tolérance aux Pannes

Nous gérons deux types de pannes : es pannes des applications et les pannes du cluster.

==== Pannes des applications

La gestion des pannes des applications est gérée par Kubernetes.

Pour y arriver, Kubernetes se base sur https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/[les lignes de vie des applications].

Si la ligne de vie d'une application ne répond pas, Kubernetes se charge de redémarrer l'application. Chaque application déployée doit donc définir ses lignes de vie.

....
@TAG SCN_APP_HEALTHCHECK
Scenario: Application HealthCheck
Given I am a developer of an application
When the applications probes do not respond
The Kubernetes restarts the application
....

==== Pannes du Cluster

La gestion des pannes du cluster est gérée par une installation multi-maîtres :

* Pour être tolérant à une panne, il faut 3 maîtres
* Pour être tolérant à deux pannes, il faut 5 maîtres

.Dimensionnement des Services
|===
|Service | Techno | CPU | Disk | Instance | Total CPU | Total Disk

|Jenkins
|Java
|4 Go
|20 Go
|1
|4 Go
|20 Go

|Nexus
|Java
|4 Go
|30 Go
|1
|4 Go
|30 Go

|SonarQube
|Java
|4 Go
|30 Go
|1
|4 Go
|30 Go

|Kibana
|Node
|2 Go
|1 Go
|1
|2 Go
|1 Go

|ElasticSearch
|Java
|2 Go
|20 Go
|2
|4 Go
|40 Go

|FileBeat
|Java
|512 Mo
|1 Go
|1 par slave
|
|

|User Mgmt
|C#
|1 Go
|1 Go
|2
|2 Go
|2 Go

|User Mgmt Database
|MongoDB
|512 Mo
|1 Go
|2
|1 Go
|2 Go

|Mission Mgmt
|Kotlin
|1 Go
|1 Go
|2
|2 Go
|2 Go

|Mission Mgmt Database
|PostgreSQL
|512 Mo
|1 Go
|2
|1 Go
|2 Go

|Team Mgmt
|Node
|512 Mo
|1 Go
|2
|1 Go
|2 Go

|Team Mgmt Database
|PostgreSQL
|512 Mo
|1 Go
|2
|1 Go
|2 Go

|Team Skill Mgmt
|Kotlin
|1 Go
|1 Go
|2
|2 Go
|2 Go

|Team Skill Mgmt Database
|Kafka
|2 Go
|10 Go
|3
|6 Go
|30 Go

|User Skill Mgmt
|Java
|1 Go
|1 Go
|2
|2 Go
|2 Go

|User Skill Mgmt Database
|ElasticSearch
|instance infre
|idem
|idem
|idem
|idem

|Total
|
|
|
|
|38 Go
|167 Go

|===


.Dimensionnement du Cluster
|===
|Type |Instance | RAM | Total RAM

|Master
|3
|8 Go
|24 Go

|Slave
|5
|8 Go
|40 Go

|===


.Pricing
|===
|Type Serveur| RAM / Instance  | vCPU / Instance |  Prix / Instance | #Instance|  RAM Total | CPU Total | Prix Total

|VPS SSD 3
|8 Go
|2 vCPU
|12,99 €
|8
|64 Go
|16 vCPU
|103,92 €

|SP-64
|64 Go
|4c/8t
|119,99 €
|1
|64 Go
|4c/8t
|99,99 €

|SP-128-S
|128 Go
|8c/16t
|119,99 €
|1
|128 Go
|8c/16t
|169,99 €


|===
